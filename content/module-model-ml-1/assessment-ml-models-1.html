<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.545">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andreas Handel">
<meta name="description" content="Modern Applied Data Analysis (MADA) course">

<title>MADA Course - Assessment - Machine Learning Models 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../content/module-model-ml-2/assessment-ml-models-2.html" rel="next">
<link href="../../content/model-improvement/assessment-model-improvement.html" rel="prev">
<link href="../../media/MADAlogo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../include/webex.css">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../media/MADAlogo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">MADA Course</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../courseinfo/course-overview.html"> 
<span class="menu-text">General Information</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../content/content-overview.html"> 
<span class="menu-text">Content</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../courseinfo/assessments-overview.html" aria-current="page"> 
<span class="menu-text">Assessments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../project/project-overview.html"> 
<span class="menu-text">Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources/resources-overview.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/andreashandel/MADAcourse"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../content/module-model-ml-1/assessment-ml-models-1.html">11. Machine Learning Models I</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../courseinfo/assessments-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assessments Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/module-intro-tools/assessment-course-tools-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Course and Tools Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/module-data-analysis/assessment-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Data Analysis Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/module-coding-basics/assessment-coding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. R Coding Basics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/module-data/assessment-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. All about Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/module-data-processing/assessment-data-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Processing Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/module-data-presentation/assessment-presenting-results.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Presenting Data and Results</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/module-stats-overview/assessment-statistical-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Statistical Analysis Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/model-fitting/assessment-model-fitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Model Fitting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/model-assessment/assessment-model-assessment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Model Assessment</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/model-improvement/assessment-model-improvement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Model Improvement</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/module-model-ml-1/assessment-ml-models-1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">11. Machine Learning Models I</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/module-model-ml-2/assessment-ml-models-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Machine Learning Models II</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/module-workflow/assessment-complete-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Complete Analysis Workflow</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#quiz" id="toc-quiz" class="nav-link active" data-scroll-target="#quiz">Quiz</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries">Preliminaries</a></li>
  <li><a href="#more-processing" id="toc-more-processing" class="nav-link" data-scroll-target="#more-processing">More processing</a></li>
  <li><a href="#pairwise-correlations" id="toc-pairwise-correlations" class="nav-link" data-scroll-target="#pairwise-correlations">Pairwise correlations</a></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">Feature engineering</a></li>
  <li><a href="#model-building" id="toc-model-building" class="nav-link" data-scroll-target="#model-building">Model building</a></li>
  <li><a href="#first-fit" id="toc-first-fit" class="nav-link" data-scroll-target="#first-fit">First fit</a></li>
  <li><a href="#tuning-the-models" id="toc-tuning-the-models" class="nav-link" data-scroll-target="#tuning-the-models">Tuning the models</a></li>
  <li><a href="#tuning-with-cv" id="toc-tuning-with-cv" class="nav-link" data-scroll-target="#tuning-with-cv">Tuning with CV</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#ml-and-speed" id="toc-ml-and-speed" class="nav-link" data-scroll-target="#ml-and-speed">ML and speed</a></li>
  <li><a href="#final-test-and-website-update" id="toc-final-test-and-website-update" class="nav-link" data-scroll-target="#final-test-and-website-update">Final test and website update</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assessment - Machine Learning Models 1</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Andreas Handel </p>
          </div>
  </div>
    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">2024-03-20</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="quiz" class="level1">
<h1>Quiz</h1>
<p>Get the quiz sheet for this module from the general <a href="../../courseinfo/assessments-overview.html"><strong>Assessments</strong></a> page. Fill it in, then submit to the online grading system before the deadline.</p>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>We‚Äôll use this week‚Äôs discussion to talk a bit more about the projects. Last week you received feedback on our project from a few classmates, this week I want everyone to have a chance to hear about and comment on all projects.</p>
<p>To that end, post a summary of your project to the <strong>discussion</strong> channel for this week. Briefly describe your data, your question(s), your (planned) methods and (expected) results. Similar to an abstract for a paper, or a summary for a report. This way, everyone can get a quick glimpse as to what everyone else is doing. Also provide a link to the repo for easy access (for private repositories, you can skip this).</p>
<p>Also mention specific questions/struggles/concerns you might have regarding your project. It‚Äôs quite likely that there is some overlap in approaches and struggles among you and your classmates. Hopefully, through this discussion you can provide each other with some help and input.</p>
<p>Post by Wednesday. Then read the summaries of your classmates‚Äô projects. If you see a question/topic that you think you might be able to help with, either by answering a specific question, or by providing some general feedback, do so. Of course, you are also welcome to take inspiration from what you see others doing and integrate some of that into your own project.</p>
<p>Since you get feedback from me at the other submission points, I will stay out of this week‚Äôs discussion üòÅ. So this is all you helping each other. Each of you has already seen a few projects and will be reviewing 2 projects in depth at the end. With this week‚Äôs discussion, you get a chance to learn about all the projects, get an idea of what everyone else is doing, and you can comment on any project you want.</p>
</section>
<section id="exercise" class="level1">
<h1>Exercise</h1>
<p>For this exercise, we will implement some of the machine learning models covered in this module, and some of the general approaches we covered previously. This is a continuation of the exercise you‚Äôve been working on over the last few weeks.</p>
<p><strong>Note: This exercise is likely time-consuming and you might get stuck. Please plan accordingly. Start early and ask for help if needed.</strong> The documentation on the <code>tidymodels</code> website will likely be very helpful for figuring out the different bits of code you need to write here.</p>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>This is a solo-exercise, and it‚Äôs part of your portfolio.</p>
<p>Since the previous Quarto document was getting long, we‚Äôll set this up as a different one. Make a new folder in your portfolio repo and call it <code>ml-models-exercise</code>.</p>
<p>If you haven‚Äôt done yet, update your previous code to save the clean data (with the variable <code>SEX</code> included) from the last exercise into an <code>Rds</code> file. Copy that <code>Rds</code> file into the newly created folder. Also in this new folder, start a new quarto file called <code>ml-models-exercise.qmd</code>.</p>
<p>Open the new quarto file you just created, and we should be ready to go.</p>
</section>
<section id="preliminaries" class="level2">
<h2 class="anchored" data-anchor-id="preliminaries">Preliminaries</h2>
<p>Write code to load your packages. You already know you‚Äôll need <code>tidymodels</code> and probably <code>ggplot2</code>. You can add other package loading commands later. Also define a random number seed. Set it to the value 1234. Then load the data.</p>
</section>
<section id="more-processing" class="level2">
<h2 class="anchored" data-anchor-id="more-processing">More processing</h2>
<p>Just to practice, we‚Äôll do a bit more data wrangling.</p>
<p>Earlier, we dropped the variable <code>SEX</code>. Now we decide we want to keep it. Let‚Äôs go on a ‚Äòtreasure hunt‚Äô. Try to find out what the values used to encode race stand for. This is the kind of task one has to do at times for any real-world data analysis. Spend a few minutes to see if you can figure out the meaning of the numbers.</p>
<p>If you can‚Äôt find out the meaning, that‚Äôs ok for the purpose of the exercise. What we‚Äôll do is to combine the two rare numbers into a single category, so that we are left with race 1,2, and 3, where the latter is a re-coding of everyone with a 7 and 88.</p>
<div class="instruction">
<p>Write code that changes the <code>RACE</code> variable such that it combines categories 7 and 88 and calls them 3.</p>
</div>
</section>
<section id="pairwise-correlations" class="level2">
<h2 class="anchored" data-anchor-id="pairwise-correlations">Pairwise correlations</h2>
<p>Next, let‚Äôs make a pairwise correlation plot for the continuous variables. If we were to find any very strong correlations, we might want to remove those.</p>
<div class="instruction">
<p>Write code to make a correlation plot for the continuous variables.</p>
</div>
<p>You‚Äôll see that while some variables are reasonably strongly correlated, nothing seems excessive (e.g., above an absolute value 0.9). So looks like we won‚Äôt have too much of a problem with collinearity.</p>
<!-- ## Near-zero variance -->
<!-- As we discussed, sometimes there might be a variable that contains little information, e.g. if pretty much everyone belongs to a single category or has very similar numbers. For instance if we had a data set of individuals, and every individual had the same value for SEX or RACE, it wouldn't contain any useful information to predict the outcome (though it could be quite important for interpreting the results from the study!) In such a case, it is generally best to remove that variable before modeling. Similarly, if you had a data set where everyone had an age between 39 and 41 years, it's likely not informative. -->
<!-- The EDA of the data, where you plot histograms and boxplots and similar figures should have already alerted you to such potential problems. We can also test that more formally. -->
<!-- ::: instruction -->
<!-- Write code that looks at near-zero variance in the predictors. -->
<!-- ::: -->
<!-- It looks like no problems here either, so we can keep the variables. -->
</section>
<section id="feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering">Feature engineering</h2>
<p>As you learned, <em>feature engineering</em> is a fancy word for creating new variables (or more broadly, doing stuff to existing variables, e.g., one could interpret our recoding of <code>RACE</code> above as feature engineering).</p>
<p>Let‚Äôs become a feature engineer üòÅ. Our data contains height and weight for each individual (<code>HT</code> and <code>WT</code>). There‚Äôs usually some correlation between those ‚Äì which you likely noticed above when you did the pairwise correlation. It‚Äôs not too strong here, but maybe it would still be good to combine these variables into a new one. Let‚Äôs do that by computing BMI.</p>
<div class="instruction">
<p>Look up the formula for BMI. Then add a new variable to the data frame called <code>BMI</code>, computed from the <code>HT</code> and <code>WT</code> variables. Be careful with the units! Since we don‚Äôt have a codebook that explains the variables and their units, you have to guess.</p>
</div>
</section>
<section id="model-building" class="level2">
<h2 class="anchored" data-anchor-id="model-building">Model building</h2>
<p>We are finally done with our additional processing bits and are ready to fit some models. Specifically, we will explore these 3 models:</p>
<ul>
<li><p>For the first model, we‚Äôll revisit the one we had previously, namely a linear model with all predictors.</p></li>
<li><p>For our second model, we‚Äôll do a LASSO.</p></li>
<li><p>For our third model, we‚Äôll do a random forest (RF).</p></li>
</ul>
<p>As we discussed, sometimes it‚Äôs useful to do a train/test split, so that we can do a final model assessment at the end. Depending on your question and setup, that might or might not be useful. For this exercise we‚Äôll skip this split. Instead, we‚Äôll use all the data and perform cross-validation to try and get an ‚Äúhonest‚Äù assessment of the performance of our models.</p>
</section>
<section id="first-fit" class="level2">
<h2 class="anchored" data-anchor-id="first-fit">First fit</h2>
<p>We‚Äôll start by performing a single fit to the training data, without any CV and model tuning.</p>
<p>As always, we should compare to a null model that includes no predictors. Since we already did that previously, we don‚Äôt need to repeat here.</p>
<p>Some algorithms, such as random forest, do at times use random numbers. So to ensure reproducibility, set a seed to the value given above.</p>
<div class="instruction">
<p>Create <code>tidymodels</code> workflows/recipes and fit the 3 models specified above to the data. The outcome is <code>Y</code>, predictors are all other variables. Use the <code>glmnet</code> engine for the LASSO and the <code>ranger</code> engine for the random forest. Ignore any kind of tuning for the models for now. For the LASSO model, set the penalty to 0.1. We‚Äôll tune it later. For the random forest, we‚Äôll keep all the defaults as they are and don‚Äôt specify any for now.</p>
</div>
<div class="note">
<p>You‚Äôll likely have to install some further R packages to do LASSO and random forest, namely the <code>glmnet</code> and `ranger`` packages.</p>
</div>
<p>Once you fit each model, use the model to make predictions and report the RMSE performance metric for each model fit. Also make a observed versus predicted plot for the 3 models.</p>
<p>You should find that linear model and the LASSO give pretty much the same results. Can you explain why that is?</p>
<p>You should also find that the random forest performs best, with a RMSE of around 356 and predictions that are overall closer to the observations (closer to the 45 degree line) in the observed versus predicted plot.</p>
<p>This isn‚Äôt entirely surprising, because random forest models are very flexible and thus can capture a lot of the patterns seen in the data. The danger is that they easily overfit.</p>
</section>
<section id="tuning-the-models" class="level2">
<h2 class="anchored" data-anchor-id="tuning-the-models">Tuning the models</h2>
<p>Now we‚Äôll do something that you should never do in the real world!</p>
<p>The LASSO and RF both have tuning parameters. Tuning them will often improve model performance. So let‚Äôs tune them now.</p>
<p>The stupid thing we‚Äôll be doing is tuning them by repeated fitting to the sdata <strong>without</strong> cross-validation. This means model performance is evaluated on the data used for tuning. This pretty much guarantees that we‚Äôll overfit our model. This is a bad idea, but it is instructive to see what happens, so let‚Äôs do that.</p>
<div class="note">
<p>The <a href="https://www.tidymodels.org/start/tuning/">Tune model parameters</a> section of the Tidymodels tutorial and <a href="https://juliasilge.com/blog/lasso-the-office/">this blog post</a> might be useful to look at.</p>
</div>
<p>Write code that tunes the LASSO and RF models (there is nothing to tune for the linear model, it‚Äôs so simple it doesn‚Äôt have any tuning parameters).</p>
<p>For LASSO, define a grid of parameters to tune over that range from 1E-5 to 1E2 (pick 50 values linearly spaced on a log scale). Note that here, our ‚Äúgrid‚Äù is just a number of values. But as you‚Äôll see below, for models that have multiple tuning parameters, it does become a grid.</p>
<p>Use <code>tune_grid</code> to tune the model by testing model performance for each parameter value you defined as the search grid.</p>
<p>To create an object that only contains the data, and that you can use as <code>resamples</code> input for <code>tune_grid</code>, use the <code>apparent()</code> function.</p>
<p>Once you have done the tuning, you can take a look at some diagnostics by sending your object returned from the <code>tune_grid()</code> function to <code>autoplot()</code>. For instance if you tuned the tree and saved the result as <code>tree_tune_res</code>, you can run <code>tree_tune_res %&gt;% autoplot()</code>. Depending on the model, the plot will be different, but in general it shows you what happened during the tuning process.</p>
<p>For the LASSO, you‚Äôll see RMSE as function of penalty parameter. You should see that the LASSO does best (lowest RMSE) for low penalty values and gets worse if the penalty parameter increases. At the lowest penalty, the RMSE is the same as for the linear model.</p>
<p>Explain why you see this behavior. What are you doing here, what happens as the penalty parameter goes up? Why does the RMSE only increase and does not go lower than the value found from the linear model or the un-tuned model above? You‚Äôll likely need to re-read the LASSO section on the course website to really understand what is going on here.</p>
<p>Now, let‚Äôs repeat with a random forest. Different ML algorithms have different tuning parameters. It‚Äôs usually a good idea to look them up to understand at least a bit what they mean and do. You can check this for the <code>ranger</code> algorithm by looking at its help file. There‚Äôs a bunch we could tune. We‚Äôll tune over the parameters <code>mtry</code> and <code>min_n</code> and fix <code>trees</code> at 200. Everything else we keep at their defaults. Update your model/workflow accordingly.</p>
<p>Then set up a tuning grid with the <code>grid_regular()</code> function. Do a range for <code>mtry</code> between 1 and 7, <code>min_n</code> between 1 and 21, and 7 levels for each parameter. (That means we‚Äôll be trying 7 x 7 tuning parameter combinations).</p>
<p>The tuning might take several seconds. Once done, use the <code>autoplot</code> function to look at the results. You‚Äôll see a plot showing how RMSE changes as you change the tuning parameters. You‚Äôll see that a higher value of <code>mtry</code> and a lower one for <code>min_n</code> lead to the best results. This model isn‚Äôt as easily understandable as the linear and LASSO models, so it‚Äôs not quite clear why those values for the tuning parameters should give the best performance. This is one of the drawbacks of complex ML/AI models, they are harder to interpret. We could probably understand this if we thought more about it. But for now, let‚Äôs move on.</p>
</section>
<section id="tuning-with-cv" class="level2">
<h2 class="anchored" data-anchor-id="tuning-with-cv">Tuning with CV</h2>
<p>Now it‚Äôs time to do the tuning properly, by using CV to evaluate model performance during the tuning process.</p>
<p>Repeat the steps you did above, for tuning both the LASSO and RF. But now, instead of creating silly resamples with the <code>apparent()</code> function that weren‚Äôt actually samples but just the data, we‚Äôll now create real samples. Let‚Äôs do 5-fold cross-validation, 5 times repeated. (There‚Äôs no specific reason to do this 5x5 pattern, other than to show you that there are different ways to pick the sample, and that I want you to not use the default.) Use the <code>vfold_cv()</code> function to create a resample object with these specifications. Since this uses samples, re-set the random number seed.</p>
<p>Then redo the tuning of both models. You can keep everything as before, the only thing that needs to change in the <code>tune_grid()</code> function is to replace the <code>resamples</code> input, now with real samples generated by the <code>vfold_cv()</code> function.</p>
<p>Running this code will now take time. It‚Äôs basically 5x5 = 25 times as long as what you ran above. So it might take several minutes.</p>
<p>Once done, look at the results from both the LASSO and the RF again using the <code>autoplot()</code> function.</p>
<p>Compare what you see for the RMSE here with the results above when we didn‚Äôt use CV to evaluate our model. You should find that the LASSO still does best for a small penalty, the RMSE for both models went up, and the LASSO now has lower RMSE compared to the RF. Explain why you are seeing what you do.</p>
<p>Based on what you find here, which model performs better?</p>
<p>We should also compare the results to the linear model we had initially. However, this is not really necessary, since the LASSO with a small penalty is essentially the linear model. If this is not clear why, revisit the discussion of LASSO on the course page.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>I hope this exercise showed you a few things, the main ones to me are:</p>
<ul>
<li><p>Complex models need tuning and with tuning they can get close to the data.</p></li>
<li><p>Because complex models can fit data well, it‚Äôs important to not evaluate their performance on the data that was used to tune/train them. Otherwise one will make overly confident conclusions and the models will likely perform poorly on new data.</p></li>
</ul>
</section>
<section id="ml-and-speed" class="level2">
<h2 class="anchored" data-anchor-id="ml-and-speed">ML and speed</h2>
<p>This is probably the first exercise where things started slowing down. Once you do bigger models with more data, and extensive tuning and CV, things slow down. It is possible and generally not too hard to parallelize some code. For instance for CV, you could run each sample on a different core. This can often give you a lot of speedup. We won‚Äôt go into this here.</p>
<p>You‚Äôll also find that as things slow down, including computationally intensive code into your Quarto documents can be annoying, since each time you re-render the code might run and take a lot of time. Some options to deal with this are:</p>
<ul>
<li><p>Move to a mix of R scripts for computation and Quarto for showing the results.</p></li>
<li><p>Set specific code chunks to not execute during rendering. Instead, run those code chunks manually, save the results to a file, and in your Quarto document, you don‚Äôt execute the code chunk that does the computation but instead just load the previously computed code chunk.</p></li>
<li><p>Quarto also lets you set a project-wide <code>freeze</code> option that you can set to only re-render a file when it changed. You might want to use this in combination with the ideas above.</p></li>
</ul>
</section>
<section id="final-test-and-website-update" class="level2">
<h2 class="anchored" data-anchor-id="final-test-and-website-update">Final test and website update</h2>
<p>Make sure your analysis and all results are nicely documented and everything runs/renders correctly. Then, add the newly created Quarto document as an entry into your <code>_quarto.yml</code> file, as a sub-menu of <code>Flu fitting</code>. Call it <code>Machine Learning</code>. Recompile your portfolio website and make sure everything works and shows up as expected. Then commit and push.</p>
<p><strong>Since this is part of your portfolio site, you don‚Äôt need to post anything, I know where to find it. Therefore there is no exercise Slack channel for this module.</strong></p>
<!-- ## Further model evaluation -->
<!-- Given that the RF had worse performance and is more complex, there doesn't seem to be a reason to choose it over the simpler linear/LASSO model. -->
<!-- Let's explore the LASSO model a bit more. First, let's further investigate what the LASSO does as we change the penalty. -->
<!-- You learned that the LASSO penalizes predictor variables. The penalty helps to regularize the model, which is another term of saying it helps reduce overfitting. -->
<!-- As the penalty increases, some predictors might end up being removed from the model. In that sense, it does variable selection. We can look at the the number of predictors included in the LASSO model as the penalty/tuning parameter is changed. -->
<!-- To do so, you need to get the best model with `select_best()` applied to the object you got back from tuning the LASSO. Then use `finalize_workflow()` to get a final model.  -->
<!-- , you can extract the model from your final fit (say it's called `best_lasso_fit`) with `x <- best_lasso_fit$fit$fit$fit` and then `plot(x, "lambda")`. I know, this is awful code having to dig that deep into the `best_lasso_fit` object. You might also be able to use the `extract_fit_engine()` function to get the underlying fit object produced by LASSO, e.g., `x <- extract_fit_engine(best_lasso_fit)` might work (this is new in `tidymodels` and I haven't fully tried it yet). -->
<!-- 1)  Make two plots, one that shows model predictions from the tuned model versus actual outcomes, and one that plots residuals. The actual outcomes you get straight from the data, the predicted outcomes you can get by applying the `predict()` function to the final fit. -->
<!-- ::: note -->
<!-- Fitting speed, Quarto options, etc. -->
<!-- ::: -->
<!-- ### Model selection -->
<!-- Once you have implemented above steps for the 3 models, you should have a "best" fit for each one based on the tuning process. For each best model you should have performance, uncertainty around the performance measure, and some diagnostic plots. While for any real research project, you likely want to look deeper (e.g. at uncertainty in predictions instead of just overall performance), for now this is enough. Pick one of the three models. Explain why you pick it. There is no single answer that's correct, I just want you to practice reasoning for why you are doing something: in this case justify why you are picking the model you do. -->
<!-- ### Final evaluation -->
<!-- Once you picked your final model, you are allowed to once -- **and only once** -- fit it to the test data and check how well it performs on that data. This gives you a somewhat honest estimate of how the model might perform for new, unseen data. You can do that using the `last_fit()` function applied to the model you end up choosing. For the final model applied to the test set, report performance and the diagnostic plots as above. -->
<!-- And that concludes what is likely a fairly long exercise. The code itself is not that long, but it will take you time to cobble it together from the `tidymodel` tutorial and possibly other sources. -->


</section>
</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/andreashandel\.github\.io\/MADAcourse\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../content/model-improvement/assessment-model-improvement.html" class="pagination-link  aria-label=" 10.="" model="" improvement"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">10. Model Improvement</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../content/module-model-ml-2/assessment-ml-models-2.html" class="pagination-link" aria-label="12. Machine Learning Models II">
        <span class="nav-page-text">12. Machine Learning Models II</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>