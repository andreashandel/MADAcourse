{
  "hash": "674f3313279cf0c31fe3bfaeb6caeb74",
  "result": {
    "markdown": "---\ntitle: Generating synthetic data based on existing data\nsubtitle: \"\"\n---\n\n\n\n\n\n# Overview\nIn this unit, we discuss how to generate synthetic data based on existing data.\n\n\n# Goals\n\n* Be able to generate synthetic data with `R` based on existing data.\n\n\n\n# Introduction\n\nYou generally want to produce synthetic data that resembles the real data you are interested in. The simplest approach is to just look at the variables of interest in your actual data, then write code to generate synthetic data with those variables and values for each variable that are similar to the original data.\n\nThat's quick, you can use AI to help, and often that's good enough. But sometimes you might want to generate synthetic data that resembles the original data very closely. \n\nIn that case, you will first want to determine the ranges and distributions of your existing data and then use that information to generate new synthetic data.\n\nEssentially, what you want to do is perform descriptive and explorary analysis on your real data, then use what you found to inform the creation of your synthetic data.\n\n## AI help \n\nYou probably don't want to feed your real data to the AI. So the first part of summarizing existing data has to be done in a safe/secure space. Once you have good data summaries, you can use AI to generate synthetic data and code.\n\n## Example\n\nWe'll use the data we generated in example 1 of the previous tutorial and now assume that this is \"real\" data and that we want to generate synthetic data that's similar to the real data. \n\n### Setup\n\nFirst, we do the usual setup steps of package loading and other housekeeping steps.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# make sure the packages are installed\n# Load required packages\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(skimr)\nlibrary(gtsummary)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set a seed for reproducibility\nset.seed(123)\n# Define the number of observations (patients) to generate\nn_patients <- 100\n```\n:::\n\n\n\n\n### Load and explore data\n\nIn a first step, we want to understand how each variable in the real data set is distributed, so we can create synthetic data that looks very similar.\n\nWe can use various helper functions from different packages to get good descriptive summaries of the data and variables. This code below shows two such helper functions. \n\nNote that we added more information to the table output. The table summary function treats the date variable and patient ID variable as numeric, so the output is somewhat nonsensical. But this is just for internal \"quick and dirty\" use, so we don't need to make things pretty. Of course you could if you needed/wanted.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- readRDS(\"syn_dat.Rds\")\nskimr::skim(dat)\n```\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |     |\n|:------------------------|:----|\n|Name                     |dat  |\n|Number of rows           |100  |\n|Number of columns        |8    |\n|_______________________  |     |\n|Column type frequency:   |     |\n|character                |2    |\n|Date                     |1    |\n|numeric                  |5    |\n|________________________ |     |\n|Group variables          |None |\n\n\n**Variable type: character**\n\n|skim_variable  | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:--------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|Gender         |         0|             1|   4|   6|     0|        2|          0|\n|TreatmentGroup |         0|             1|   1|   7|     0|        3|          0|\n\n\n**Variable type: Date**\n\n|skim_variable  | n_missing| complete_rate|min        |max        |median     | n_unique|\n|:--------------|---------:|-------------:|:----------|:----------|:----------|--------:|\n|EnrollmentDate |         0|             1|2022-01-08 |2022-12-30 |2022-06-25 |       86|\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|   mean|    sd|   p0|    p25|    p50|    p75|  p100|hist  |\n|:-------------|---------:|-------------:|------:|-----:|----:|------:|------:|------:|-----:|:-----|\n|PatientID     |         0|             1|  50.50| 29.01|  1.0|  25.75|  50.50|  75.25| 100.0|▇▇▇▇▇ |\n|Age           |         0|             1|  45.90|  9.14| 21.9|  40.08|  45.60|  51.92|  66.9|▁▃▇▅▂ |\n|BloodPressure |         0|             1| 127.96| 21.31| 91.3| 110.67| 130.85| 147.38| 159.5|▅▅▅▅▇ |\n|Cholesterol   |         0|             1| 174.67| 32.58| 88.9| 153.23| 171.85| 196.62| 271.0|▁▆▇▃▁ |\n|AdverseEvent  |         0|             1|   0.29|  0.46|  0.0|   0.00|   0.00|   1.00|   1.0|▇▁▁▁▃ |\n:::\n\n```{.r .cell-code}\ngtsummary::tbl_summary(dat, statistic = list(\n  all_continuous() ~ \"{mean}/{median}/{min}/{max}/{sd}\",\n  all_categorical() ~ \"{n} / {N} ({p}%)\"\n),)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"osncjrvket\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#osncjrvket table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#osncjrvket thead, #osncjrvket tbody, #osncjrvket tfoot, #osncjrvket tr, #osncjrvket td, #osncjrvket th {\n  border-style: none;\n}\n\n#osncjrvket p {\n  margin: 0;\n  padding: 0;\n}\n\n#osncjrvket .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#osncjrvket .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#osncjrvket .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#osncjrvket .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#osncjrvket .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#osncjrvket .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#osncjrvket .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#osncjrvket .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#osncjrvket .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#osncjrvket .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#osncjrvket .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#osncjrvket .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#osncjrvket .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#osncjrvket .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#osncjrvket .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#osncjrvket .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#osncjrvket .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#osncjrvket .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#osncjrvket .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#osncjrvket .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#osncjrvket .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#osncjrvket .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#osncjrvket .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#osncjrvket .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#osncjrvket .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#osncjrvket .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#osncjrvket .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#osncjrvket .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#osncjrvket .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#osncjrvket .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#osncjrvket .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#osncjrvket .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#osncjrvket .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#osncjrvket .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#osncjrvket .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#osncjrvket .gt_left {\n  text-align: left;\n}\n\n#osncjrvket .gt_center {\n  text-align: center;\n}\n\n#osncjrvket .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#osncjrvket .gt_font_normal {\n  font-weight: normal;\n}\n\n#osncjrvket .gt_font_bold {\n  font-weight: bold;\n}\n\n#osncjrvket .gt_font_italic {\n  font-style: italic;\n}\n\n#osncjrvket .gt_super {\n  font-size: 65%;\n}\n\n#osncjrvket .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#osncjrvket .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#osncjrvket .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#osncjrvket .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#osncjrvket .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#osncjrvket .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#osncjrvket .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Characteristic&lt;/strong&gt;\"><strong>Characteristic</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;N = 100&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><strong>N = 100</strong><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PatientID</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">51/51/1/100/29</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Age</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">46/46/22/67/9</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Gender</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    Female</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">49 / 100 (49%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    Male</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">51 / 100 (51%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">TreatmentGroup</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    A</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">43 / 100 (43%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    B</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">30 / 100 (30%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    Placebo</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">27 / 100 (27%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">EnrollmentDate</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">2022-06-30/2022-06-25/2022-01-08/2022-12-30/107.06744593852</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">BloodPressure</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">128/131/91/160/21</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Cholesterol</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">175/172/89/271/33</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">AdverseEvent</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">29 / 100 (29%)</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"2\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span> Mean/Median/Minimum/Maximum/SD; n / N (%)</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n:::\n:::\n\n\nWe can also look at the distribution of the different variables individually, using e.g., base `R` commands (or any other package of your choice).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# using base R to explore variable distributions\ntable(dat$Gender)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nFemale   Male \n    49     51 \n```\n:::\n\n```{.r .cell-code}\ntable(dat$TreatmentGroup)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n      A       B Placebo \n     43      30      27 \n```\n:::\n\n```{.r .cell-code}\ntable(dat$AdverseEvent)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n 0  1 \n71 29 \n```\n:::\n\n```{.r .cell-code}\nhist(dat$Age)\n```\n\n::: {.cell-output-display}\n![](synthetic-data-new-existing-R_files/figure-html/explore-variables-1.png){width=672}\n:::\n\n```{.r .cell-code}\nhist(dat$BloodPressure)\n```\n\n::: {.cell-output-display}\n![](synthetic-data-new-existing-R_files/figure-html/explore-variables-2.png){width=672}\n:::\n\n```{.r .cell-code}\nhist(dat$Cholesterol)\n```\n\n::: {.cell-output-display}\n![](synthetic-data-new-existing-R_files/figure-html/explore-variables-3.png){width=672}\n:::\n:::\n\n\nLooks like a normal distribution for age and uniform distribution for blood pressure should work well. That's of course not surprising since we produced the data that way in an earlier tutorial. But for real data you don't know what process produced it, you just want to see how things are distributed so you can recreate it that way.\n\nFor Cholesterol, the distribution doesn't look quite normal. That's because in the original data generating process, we made it dependent on treatment. \n\nIf you want to see if there are correlations in the data that you might want to also have in your synthetic data, you can explore those with tables or plots like these. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# explore some correlations between variables\ntable(dat$AdverseEvent, dat$TreatmentGroup)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   \n     A  B Placebo\n  0 28 19      24\n  1 15 11       3\n```\n:::\n\n```{.r .cell-code}\nplot(dat$Age, dat$BloodPressure)\n```\n\n::: {.cell-output-display}\n![](synthetic-data-new-existing-R_files/figure-html/explore-correlations-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(dat) + geom_histogram(aes(x = Cholesterol, fill = TreatmentGroup)) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](synthetic-data-new-existing-R_files/figure-html/explore-correlations-2.png){width=672}\n:::\n:::\n\n\nAt this stage, it is up to you to decide if you want to try to include correlations between variables that might or might not exist in the real data, or if you just want to give each variable an independent distribution.\n\n\n### Generate data\n\nNow we'll create synthetic data that is similar to the real data. In this code example, we pull directly from the actual data stored in `dat`. However, you can also save that information into an intermediary object or file (e.g., save the mean and standard deviation of age) and then just use those summary statistics to generate the synthetic data. This prevents for instance issues with confidentiality if you use AI to help write the synthetic data code.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create an empty data frame with placeholders for variables\nsyn_dat <- data.frame(\n  PatientID = numeric(n_patients),\n  Age = numeric(n_patients),\n  Gender = character(n_patients),\n  TreatmentGroup = character(n_patients),\n  EnrollmentDate = lubridate::as_date(character(n_patients)),\n  BloodPressure = numeric(n_patients),\n  Cholesterol = numeric(n_patients),\n  AdverseEvent = integer(n_patients)\n)\n\n# Variable 1: Patient ID\n# can be exactly the same as the original\nsyn_dat$PatientID <- 1:n_patients\n\n# Variable 2: Age (numeric variable)\n# creating normally distributed values with the mean and SD taken \n# from the real data\nsyn_dat$Age <- round(rnorm(n_patients, mean = mean(dat$Age), sd = sd(dat$Age)), 1)\n\n# Variable 3: Gender (categorical variable)\n# create with probabilities based on real data distribution\nsyn_dat$Gender <- sample(c(\"Male\", \"Female\"), \n                         n_patients, replace = TRUE, \n                         prob = as.numeric(table(dat$Gender)/100))\n\n# Variable 4: Treatment Group (categorical variable)\n# create with probabilities based on real data distribution\nsyn_dat$TreatmentGroup <- sample(c(\"A\", \"B\", \"Placebo\"), \n                                 n_patients, \n                                 replace = TRUE,\n                                 prob = as.numeric(table(dat$TreatmentGroup)/100))\n\n# Variable 5: Date of Enrollment (date variable)\n# use same start and end dates as real data\nsyn_dat$EnrollmentDate <- lubridate::as_date(sample(seq(from = min(dat$EnrollmentDate), \n                                                        to = max(dat$EnrollmentDate), \n                                                        by = \"days\"), n_patients, replace = TRUE))\n\n# Variable 6: Blood Pressure (numeric variable)\n# use uniform distribution as indicated by histogram of real data\n# use same min and max values as real data\nsyn_dat$BloodPressure <- round(runif(n_patients, \n                                     min = min(dat$BloodPressure), \n                                     max = max(dat$BloodPressure)), 1)\n\n# Variable 7: Cholesterol Level (numeric variable)\n# here, we re-create it based on the overall data distribution pattern\n# since the data didn't quite look like a normal distribution, \n# here we'll just use it as its own distribution and sample right from the data\n# note that this breaks the association with treatment group \n# for real data, we wouldn't know if there is any, but if we suspect, we could\n# generate data with and without such associations and explore its impact on model performance\nsyn_dat$Cholesterol <- sample(dat$Cholesterol, \n                                    size = n_patients, \n                                    replace = TRUE)\n\n\n# Variable 8: Adverse Event (binary variable, 0 = No, 1 = Yes)\n# we implement this variable by taking into account different probabilities stratified by treatment\nprobA = as.numeric(table(dat$AdverseEvent,dat$TreatmentGroup)[,1])/sum(table(dat$AdverseEvent,dat$TreatmentGroup)[,1])\nprobB = as.numeric(table(dat$AdverseEvent,dat$TreatmentGroup)[,2])/sum(table(dat$AdverseEvent,dat$TreatmentGroup)[,2]) \nprobP = as.numeric(table(dat$AdverseEvent,dat$TreatmentGroup)[,3])/sum(table(dat$AdverseEvent,dat$TreatmentGroup)[,3])\n\n# this re-creates the correlation we find between those two variables\nsyn_dat$AdverseEvent[syn_dat$TreatmentGroup == \"A\"] <- sample(0:1, sum(syn_dat$TreatmentGroup == \"A\"), replace = TRUE, prob = probA)\nsyn_dat$AdverseEvent[syn_dat$TreatmentGroup == \"B\"] <- sample(0:1, sum(syn_dat$TreatmentGroup == \"B\"), replace = TRUE, prob = probB)\nsyn_dat$AdverseEvent[syn_dat$TreatmentGroup == \"Placebo\"] <- sample(0:1, sum(syn_dat$TreatmentGroup == \"Placebo\"), replace = TRUE, prob = probP)\n```\n:::\n\n\n\nYou can always make your synthetic data partially different from the real data for important quantities (e.g., your main input/exposure or outcome of interest) to explore different implications and model performance.\n\n### Check and save data\n\nQuick peek at generated data to make sure things look ok, then we can save it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Print the first few rows of the generated data\nhead(syn_dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  PatientID  Age Gender TreatmentGroup EnrollmentDate BloodPressure Cholesterol\n1         1 36.0   Male              A     2022-06-26         114.3       151.7\n2         2 45.1 Female        Placebo     2022-04-13         152.3       120.1\n3         3 55.7   Male              A     2022-02-02          93.5       183.8\n4         4 44.6   Male              A     2022-08-25         107.5       148.7\n5         5 35.3   Male              B     2022-06-04         138.1       190.3\n6         6 38.4 Female              A     2022-12-23         106.7       142.6\n  AdverseEvent\n1            0\n2            0\n3            0\n4            1\n5            0\n6            1\n```\n:::\n\n```{.r .cell-code}\n# quick summaries\nsummary(syn_dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   PatientID           Age           Gender          TreatmentGroup    \n Min.   :  1.00   Min.   :16.40   Length:100         Length:100        \n 1st Qu.: 25.75   1st Qu.:40.10   Class :character   Class :character  \n Median : 50.50   Median :45.10   Mode  :character   Mode  :character  \n Mean   : 50.50   Mean   :45.83                                        \n 3rd Qu.: 75.25   3rd Qu.:50.33                                        \n Max.   :100.00   Max.   :65.50                                        \n EnrollmentDate       BloodPressure    Cholesterol     AdverseEvent \n Min.   :2022-01-15   Min.   : 92.7   Min.   : 97.6   Min.   :0.00  \n 1st Qu.:2022-04-12   1st Qu.:107.5   1st Qu.:158.0   1st Qu.:0.00  \n Median :2022-06-28   Median :126.9   Median :170.6   Median :0.00  \n Mean   :2022-06-27   Mean   :125.8   Mean   :175.4   Mean   :0.31  \n 3rd Qu.:2022-09-23   3rd Qu.:144.3   3rd Qu.:196.1   3rd Qu.:1.00  \n Max.   :2022-12-26   Max.   :159.0   Max.   :248.7   Max.   :1.00  \n```\n:::\n\n```{.r .cell-code}\ndplyr::glimpse(syn_dat)  \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 100\nColumns: 8\n$ PatientID      <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, …\n$ Age            <dbl> 36.0, 45.1, 55.7, 44.6, 35.3, 38.4, 52.2, 43.0, 33.9, 4…\n$ Gender         <chr> \"Male\", \"Female\", \"Male\", \"Male\", \"Male\", \"Female\", \"Fe…\n$ TreatmentGroup <chr> \"A\", \"Placebo\", \"A\", \"A\", \"B\", \"A\", \"Placebo\", \"B\", \"A\"…\n$ EnrollmentDate <date> 2022-06-26, 2022-04-13, 2022-02-02, 2022-08-25, 2022-0…\n$ BloodPressure  <dbl> 114.3, 152.3, 93.5, 107.5, 138.1, 106.7, 113.0, 103.2, …\n$ Cholesterol    <dbl> 151.7, 120.1, 183.8, 148.7, 190.3, 142.6, 151.7, 212.1,…\n$ AdverseEvent   <int> 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0…\n```\n:::\n\n```{.r .cell-code}\n# Frequency table for adverse events stratified by treatment\ntable(syn_dat$AdverseEvent,syn_dat$TreatmentGroup)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   \n     A  B Placebo\n  0 34 12      23\n  1 16 12       3\n```\n:::\n\n```{.r .cell-code}\n# ggplot2 boxplot for cholesterol by treatment group\nggplot(syn_dat, aes(x = TreatmentGroup, y = Cholesterol)) +\n  geom_boxplot() +\n  labs(x = \"Treatment Group\", y = \"Cholesterol Level\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](synthetic-data-new-existing-R_files/figure-html/check-data-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Save the simulated data to a CSV file\nwrite.csv(syn_dat, \"syn_dat_new.csv\", row.names = FALSE)\n```\n:::\n\n\n\n## Summary\n\nThe process of generating synthetic data based on existing data is fairly straightforward:\n\n1. Load existing data.\n2. Look at distributions/frequencies of variables of interest.\n3. Generate new data with variables that are distributed like original data.\n\nSometimes, you can just look at your original data and make up new data that's roughly similar. At other times you want to be very close, in that case you need to either draw new values from distributions that are well-describe the original data, or you need to re-sample the original data (with or without replacement).\n\nFortunately, most of the time it's good enough to get your data somewhat similar to the original. You would hope/expect any kind of statistical method to work well on different sets of data that are roughly similar. If that's not the case, your method might not be very robust and might require changes.\n\n\n# Further Resources\n\nThere are a number of R packages that can let you generate data more easily. We'll look at some in another unit. But it's always good to be able to do it yourself, in case you end up in a situation where the available packages can't get you what you need.\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}